{% extends "admin/base.html" %}

{% block title %}Thá»‘ng kÃª Há»c sinh{% endblock %}
{% block page_title %}ğŸ“Š Thá»‘ng kÃª Há»c sinh (YC4){% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<!-- Filter Bar -->
<div class="filter-bar">
    <form method="GET" action="{{ url_for('admin.student_report') }}">
        <div class="filter-group">
            <div class="filter-item">
                <label>NÄƒm há»c</label>
                <select name="school_year" class="form-control">
                    <option value="">Táº¥t cáº£</option>
                    {% for year in school_years %}
                    <option value="{{ year }}" {% if current_year == year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-item">
                <button type="submit" class="btn btn-primary">ğŸ” Lá»c</button>
                <a href="{{ url_for('admin.student_report') }}" class="btn btn-secondary">XÃ³a lá»c</a>
            </div>
        </div>
    </form>
</div>

<!-- Statistics by Classroom -->
<div class="table-container">
    <h3>ğŸ“š Sá»‘ há»c sinh tá»«ng lá»›p</h3>
    {% if stats.by_classroom %}
    <table>
        <thead>
            <tr>
                <th>Lá»›p há»c</th>
                <th>Sá»‘ há»c sinh</th>
            </tr>
        </thead>
        <tbody>
            {% for classroom, count in stats.by_classroom.items() %}
            <tr>
                <td>{{ classroom }}</td>
                <td><strong>{{ count }}</strong> há»c sinh</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; background: #ecf0f1;">
                <td>Tá»•ng cá»™ng</td>
                <td>{{ stats.by_classroom.values() | sum }} há»c sinh</td>
            </tr>
        </tfoot>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ‘¶</div>
        <div class="empty-state-message">ChÆ°a cÃ³ dá»¯ liá»‡u</div>
    </div>
    {% endif %}
</div>

<!-- Gender Distribution Chart (YC4) -->
<div class="chart-container" style="max-width: 600px; margin: 30px auto;">
    <h3>ğŸ‘¦ğŸ‘§ Tá»· lá»‡ giá»›i tÃ­nh (YC4 - Pie Chart)</h3>
    <canvas id="genderPieChart"></canvas>
</div>

<script>
// Gender Distribution Pie Chart (YC4)
const genderData = {{ stats.by_gender | tojson }};
const genderLabels = Object.keys(genderData);
const genderValues = Object.values(genderData);

new Chart(document.getElementById('genderPieChart'), {
    type: 'pie',
    data: {
        labels: genderLabels,
        datasets: [{
            label: 'Sá»‘ há»c sinh',
            data: genderValues,
            backgroundColor: [
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 99, 132, 0.5)'
            ],
            borderColor: [
                'rgb(54, 162, 235)',
                'rgb(255, 99, 132)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: {
                display: true,
                text: 'PhÃ¢n bá»‘ giá»›i tÃ­nh há»c sinh'
            }
        }
    }
});
</script>
{% endblock %}
