{% extends "admin/base.html" %}

{% block title %}Qu·∫£n l√Ω H·ªçc ph√≠{% endblock %}
{% block page_title %}üí∞ Qu·∫£n l√Ω H·ªçc ph√≠{% endblock %}

{% block content %}
<!-- Filter Bar -->
<div class="filter-bar">
    <form method="GET" action="{{ url_for('admin.list_fees') }}">
        <div class="filter-group">
            <div class="filter-item">
                <label>Th√°ng</label>
                <input type="number" class="form-control" name="month" min="1" max="12" 
                       value="{{ filters.get('month', '') }}" placeholder="1-12">
            </div>
            <div class="filter-item">
                <label>NƒÉm</label>
                <input type="number" class="form-control" name="year" 
                       value="{{ filters.get('year', '') }}" placeholder="2024">
            </div>
            <div class="filter-item">
                <label>Tr·∫°ng th√°i</label>
                <select name="status" class="form-control">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="pending" {% if filters.get('status') == 'pending' %}selected{% endif %}>Ch·ªù thanh to√°n</option>
                    <option value="paid" {% if filters.get('status') == 'paid' %}selected{% endif %}>ƒê√£ thanh to√°n</option>
                    <option value="partial" {% if filters.get('status') == 'partial' %}selected{% endif %}>Thanh to√°n 1 ph·∫ßn</option>
                    <option value="overdue" {% if filters.get('status') == 'overdue' %}selected{% endif %}>Qu√° h·∫°n</option>
                </select>
            </div>
            <div class="filter-item">
                <label>L·ªõp h·ªçc</label>
                <select name="classroom_id" class="form-control">
                    <option value="">T·∫•t c·∫£</option>
                    {% for classroom in classrooms %}
                    <option value="{{ classroom.id }}" {% if filters.get('classroom_id') == classroom.id %}selected{% endif %}>
                        {{ classroom.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-item">
                <button type="submit" class="btn btn-primary">üîç L·ªçc</button>
                <a href="{{ url_for('admin.list_fees') }}" class="btn btn-secondary">X√≥a l·ªçc</a>
            </div>
        </div>
    </form>
</div>

<div style="margin-bottom: 20px;">
    <a href="{{ url_for('admin.generate_fees_form') }}" class="btn btn-success">‚ûï T·∫°o h·ªçc ph√≠ th√°ng m·ªõi</a>
</div>

<!-- Fees Table -->
<div class="table-container">
    <h3>Danh s√°ch h·ªçc ph√≠ ({{ fees|length }})</h3>
    
    {% if fees %}
    <table>
        <thead>
            <tr>
                <th>Th√°ng/NƒÉm</th>
                <th>H·ªçc sinh</th>
                <th>L·ªõp</th>
                <th>T·ªïng ph√≠</th>
                <th>ƒê√£ thanh to√°n</th>
                <th>C√≤n l·∫°i</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
            </tr>
        </thead>
        <tbody>
            {% for fee in fees %}
            <tr>
                <td>{{ fee.month }}/{{ fee.year }}</td>
                <td>{{ fee.student.full_name }}</td>
                <td>{{ fee.student.classroom.name if fee.student.classroom else '-' }}</td>
                <td>{{ "{:,.0f}".format(fee.total_fee) }}ƒë</td>
                <td>{{ "{:,.0f}".format(fee.paid_amount) }}ƒë</td>
                <td>{{ "{:,.0f}".format(fee.remaining_amount) }}ƒë</td>
                <td>
                    {% if fee.status.value == 'paid' %}
                        <span class="badge badge-success">ƒê√£ thanh to√°n</span>
                    {% elif fee.status.value == 'pending' %}
                        <span class="badge badge-warning">Ch·ªù thanh to√°n</span>
                    {% elif fee.status.value == 'overdue' %}
                        <span class="badge badge-danger">Qu√° h·∫°n</span>
                    {% elif fee.status.value == 'partial' %}
                        <span class="badge badge-info">Thanh to√°n 1 ph·∫ßn</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin.fee_detail', fee_id=fee.id) }}" class="btn btn-sm btn-primary">Chi ti·∫øt</a>
                    {% if fee.remaining_amount > 0 %}
                    <a href="{{ url_for('admin.payment_form', fee_id=fee.id) }}" class="btn btn-sm btn-success">Thanh to√°n</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üí∞</div>
        <div class="empty-state-message">Ch∆∞a c√≥ h·ªçc ph√≠ n√†o</div>
        <a href="{{ url_for('admin.generate_fees_form') }}" class="btn btn-primary" style="margin-top: 20px;">‚ûï T·∫°o h·ªçc ph√≠</a>
    </div>
    {% endif %}
</div>
{% endblock %}
