{% extends "admin/base.html" %}

{% block title %}Chi ti·∫øt H·ªçc ph√≠{% endblock %}
{% block page_title %}üí∞ Chi ti·∫øt H·ªçc ph√≠{% endblock %}

{% block content %}
<div class="form-container">
    <h3>H·ªçc ph√≠ th√°ng {{ fee.month }}/{{ fee.year }}</h3>
    <h4>H·ªçc sinh: {{ student.full_name }}</h4>
    <p><strong>L·ªõp:</strong> {{ student.classroom.name if student.classroom else '-' }}</p>
    <p><strong>H·∫°n thanh to√°n:</strong> {{ fee.due_date.strftime('%d/%m/%Y') if fee.due_date else '-' }}</p>

    <h4>Chi ti·∫øt h·ªçc ph√≠</h4>
    <table style="width: 100%; margin-bottom: 20px;">
        <tr>
            <th>H·ªçc ph√≠ c∆° b·∫£n:</th>
            <td style="text-align: right;">{{ "{:,.0f}".format(fee.tuition_fee) }}ƒë</td>
        </tr>
        <tr>
            <th>Ti·ªÅn ƒÉn:</th>
            <td style="text-align: right;">{{ "{:,.0f}".format(fee.meal_fee) }}ƒë</td>
        </tr>
        <tr>
            <th>Ph√≠ kh√°c:</th>
            <td style="text-align: right;">{{ "{:,.0f}".format(fee.extra_fee) }}ƒë</td>
        </tr>
        <tr>
            <th>Gi·∫£m gi√°:</th>
            <td style="text-align: right; color: red;">-{{ "{:,.0f}".format(fee.discount) }}ƒë</td>
        </tr>
        <tr style="border-top: 2px solid #333; font-weight: bold; font-size: 1.1em;">
            <th>T·ªïng c·ªông:</th>
            <td style="text-align: right;">{{ "{:,.0f}".format(fee.total_fee) }}ƒë</td>
        </tr>
        <tr>
            <th>ƒê√£ thanh to√°n:</th>
            <td style="text-align: right; color: green;">{{ "{:,.0f}".format(fee.paid_amount) }}ƒë</td>
        </tr>
        <tr style="font-weight: bold; font-size: 1.1em;">
            <th>C√≤n l·∫°i:</th>
            <td style="text-align: right; color: {% if remaining > 0 %}red{% else %}green{% endif %};">
                {{ "{:,.0f}".format(remaining) }}ƒë
            </td>
        </tr>
    </table>

    <p><strong>Tr·∫°ng th√°i:</strong>
        {% if fee.status.value == 'paid' %}
            <span class="badge badge-success">ƒê√£ thanh to√°n</span>
        {% elif fee.status.value == 'pending' %}
            <span class="badge badge-warning">Ch·ªù thanh to√°n</span>
        {% elif fee.status.value == 'overdue' %}
            <span class="badge badge-danger">Qu√° h·∫°n</span>
        {% elif fee.status.value == 'partial' %}
            <span class="badge badge-info">Thanh to√°n 1 ph·∫ßn</span>
        {% endif %}
    </p>

    <div class="action-buttons" style="margin-bottom: 30px;">
        {% if remaining > 0 %}
        <a href="{{ url_for('admin.payment_form', fee_id=fee.id) }}" class="btn btn-success">üíµ Thanh to√°n</a>
        {% endif %}
        <a href="{{ url_for('admin.list_fees') }}" class="btn btn-secondary">‚Üê Quay l·∫°i</a>
    </div>

    <h4>L·ªãch s·ª≠ thanh to√°n</h4>
    {% if payments %}
    <table>
        <thead>
            <tr>
                <th>Ng√†y thanh to√°n</th>
                <th>S·ªë ti·ªÅn</th>
                <th>Ph∆∞∆°ng th·ª©c</th>
                <th>M√£ giao d·ªãch</th>
                <th>Ghi ch√∫</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.payment_date.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>{{ "{:,.0f}".format(payment.amount) }}ƒë</td>
                <td>
                    {% if payment.payment_method.value == 'cash' %}Ti·ªÅn m·∫∑t
                    {% elif payment.payment_method.value == 'bank_transfer' %}Chuy·ªÉn kho·∫£n
                    {% elif payment.payment_method.value == 'card' %}Th·∫ª
                    {% elif payment.payment_method.value == 'momo' %}MoMo
                    {% elif payment.payment_method.value == 'zalopay' %}ZaloPay
                    {% else %}{{ payment.payment_method.value }}
                    {% endif %}
                </td>
                <td>{{ payment.reference_number or '-' }}</td>
                <td>{{ payment.note or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üí≥</div>
        <div class="empty-state-message">Ch∆∞a c√≥ thanh to√°n n√†o</div>
    </div>
    {% endif %}
</div>
{% endblock %}
